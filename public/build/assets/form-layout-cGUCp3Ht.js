import{j as e,r as p,$ as I,m as _}from"./app-ByYHrOUV.js";import{a as E,c as F,B as j}from"./button-BuBdBdGP.js";import{u as H}from"./app-layout-CD5Lm8eP.js";import{z as V}from"./transition-CI6ZHC8s.js";import{S as D,u as G,F as W}from"./form-fields-LO_Dtlq6.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Z=E("ArrowLeft",Q);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],A=E("Save",J);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],X=E("Trash2",K);function Y({className:t,...s}){return e.jsx("div",{"data-slot":"card",className:F("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...s})}function q({className:t,...s}){return e.jsx("div",{"data-slot":"card-header",className:F("flex flex-col gap-1.5 px-6",t),...s})}function ee({className:t,...s}){return e.jsx("div",{"data-slot":"card-title",className:F("leading-none font-semibold",t),...s})}function te({className:t,...s}){return e.jsx("div",{"data-slot":"card-description",className:F("text-muted-foreground text-sm",t),...s})}function se({className:t,...s}){return e.jsx("div",{"data-slot":"card-content",className:F("px-6",t),...s})}function re({view:t,data:s,setData:n}){const i=p.useRef(!1);p.useEffect(()=>{if(t!=="liquidacion")return;const f=parseFloat(s.valor??"");let b=parseFloat(s.porcentaje??"");parseInt(s.id_tipo_liquid)===1&&parseInt(s.nrorev)===1&&(b*=4);const m=b/100,d=parseFloat(s.tasamin??""),g=parseFloat(s.tasamax??""),r=parseFloat(s.igv??"");if(!(!isNaN(f)&&!isNaN(m))){n("porcenaplica",""),n("igvporcen",""),n("subtotal",""),n("total","");return}const h=f*m;n("porcenaplica",h.toFixed(2));const c=isNaN(r)?0:h/100*r;n("igvporcen",c.toFixed(2));const a=h+c;n("subtotal",a.toFixed(2));let u=a;isNaN(d)||(u=Math.max(u,d)),!isNaN(g)&&g>0&&(u=Math.min(u,g)),n("total",u.toFixed(2)),i.current=!0},[t,s.valor,s.porcentaje,s.igv,s.tasamin,s.tasamax,s.id_tipo_liquid,s.nrorev])}function oe(t,s,n,i,f){var k;if(!((k=t==null?void 0:t.values)!=null&&k.length))return{activeOption:"",hiddenFields:[],ToggleUI:()=>null};const{label:b,values:m,fields:d}=t,g=f==="info"||f==="delete",r=p.useCallback(()=>m.find(o=>(d[o]||[]).some(l=>n[l]!=null&&n[l]!==""))||m[0],[n,d,m]),[x,h]=p.useState(()=>r()),[c,a]=p.useState(!1),u=p.useCallback(o=>{if(i==="tasaliquid")return;const l=new Set(d[o]||[]);Object.values(d).flat().forEach(T=>{l.has(T)||s(T,"")})},[d,s,i]);p.useEffect(()=>{if(c)return;const o=r();o!==x&&(h(o),u(o))},[n,c,x,r,u]);const v=p.useCallback(o=>{o!==x&&(a(!0),h(o),u(o))},[x,u]),N=p.useMemo(()=>{const o=new Set(d[x]||[]);return Object.values(d).flat().filter(l=>!o.has(l))},[d,x]);return{activeOption:x,hiddenFields:N,ToggleUI:()=>e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-medium",children:[b,":"]}),m.map(o=>e.jsx(j,{type:"button",variant:x===o?"default":"outline",onClick:()=>v(o),disabled:g,children:o},o))]})}}const y={create:{formAction:"store",method:"POST",buttonText:"Registrar",buttonClass:"bg-blue-500 hover:bg-blue-600 text-white dark:bg-blue-700 dark:hover:bg-blue-600",borderColor:"border-blue-200 dark:border-blue-950",description:"Ingresa los datos cuidadosamente.",titlePrefix:"REGISTRO DE",showSubmitButton:t=>e.jsxs(j,{disabled:t,type:"submit",className:y.create.buttonClass,children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),"Registrar"]})},update:{formAction:"update",method:"PUT",buttonText:"Actualizar",buttonClass:"bg-green-600 hover:bg-green-500 text-white dark:bg-green-700 dark:hover:bg-green-600",borderColor:"border-green-200 dark:border-green-950",description:"Actualiza los datos con cuidado.",titlePrefix:"ACTUALIZAR",showSubmitButton:t=>e.jsxs(j,{disabled:t,type:"submit",className:y.update.buttonClass,children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),"Actualizar"]})},delete:{formAction:"destroy",method:"DELETE",buttonText:"Eliminar",buttonClass:"bg-red-700 hover:bg-red-800 text-white dark:bg-red-800 dark:hover:bg-red-700",borderColor:"border-red-200 dark:border-red-950",description:"¿Estás seguro que deseas eliminar? Esta acción es irreversible.",titlePrefix:"ELIMINAR",readonly:!0,showSubmitButton:t=>e.jsxs(j,{disabled:t,type:"submit",className:y.delete.buttonClass,children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"Eliminar"]})},review:{formAction:"store",method:"POST",buttonText:"Revisar",buttonClass:"bg-purple-500 hover:bg-purple-700 text-white dark:bg-purple-500 dark:hover:bg-purple-600",borderColor:"border-purple-300 dark:border-purple-900",description:"Revisa los datos cuidadosamente.",titlePrefix:"REVISAR",readonly:!0,showSubmitButton:t=>e.jsxs(j,{disabled:t,type:"submit",className:y.review.buttonClass,children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),"Registrar"]})},info:{formAction:"info",method:"POST",buttonText:"",buttonClass:"bg-gray-500 hover:bg-gray-600 text-white dark:bg-gray-400 dark:hover:bg-gray-500",borderColor:"border-gray-200 dark:border-gray-800",description:"Consulta la información.",titlePrefix:"INFORMACIÓN DE",readonly:!0,showSubmitButton:()=>null}},ne=(t,s,n,i,f,b,m,d,g,r,x)=>p.useMemo(()=>{const h=t||"create",c=y[h];let a;if(n[`id_${i}`])a=n[`id_${i}`];else if(i==="itemsimple"){let l="";typeof r=="string"?l=r:typeof r=="object"&&(r!=null&&r.tipo)&&(l=String(r.tipo)),l&&n[`id_${l}`]&&(a=n[`id_${l}`])}!a&&h!=="create"&&console.warn(`⚠️ No se encontró formDataId. Intentado: id_${i}`+(i==="itemsimple"&&r?`, id_${typeof r=="string"?r:r.tipo}`:""));const u=`${i}.${c.formAction}`,v=typeof r=="string"?{tipo:r}:r?Object.fromEntries(Object.entries(r).map(([l,C])=>[l,String(C)])):{},N=Object.keys(v).length>0?"?"+new URLSearchParams(v).toString():"",S=`${c.titlePrefix} ${s.toUpperCase()}`,k=l=>{switch(l.preventDefault(),c.method){case"POST":f(route(u));break;case"PUT":a&&b(route(u,a));break;case"DELETE":a&&m(route(u,a));break}},o=i==="tasaliquid"?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(I,{href:`/../${i}${N}`,children:e.jsxs(j,{variant:"outline",children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Regresar"]})}),e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsx(V,{show:g,enter:"transition ease-in-out",enterFrom:"opacity-0",leave:"transition ease-in-out",leaveTo:"opacity-0",children:e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:"Guardado"})}),c.showSubmitButton(d),x&&h==="update"&&a&&e.jsx(I,{href:`/${i}/form/review/${a}${N}`,children:e.jsxs(j,{type:"button",className:"bg-purple-600 hover:bg-purple-700 text-white dark:bg-purple-500 dark:hover:bg-purple-600",children:[e.jsx(D,{className:"mr-2 h-4 w-4"}),"Revisar"]})})]})]});return{...c,title:S,handleSubmit:k,FooterButtons:o}},[t,s,n,i,f,b,m,d,g,r,x]),ue=({form_data:t,formFields:s,sheetFields:n,action:i,custom_title:f,view:b,width_form:m="w-full",readonly:d=!1,queryparams:g,toggleOptions:r,submitForm:x,apiConfig:h})=>{const{data:c,setData:a,post:u,put:v,delete:N,processing:S,errors:k,recentlySuccessful:o}=_(t),l=p.useRef({}),C=H();re({view:b,data:c,setData:a});const{title:T,description:R,borderColor:w,readonly:P,handleSubmit:M,FooterButtons:O}=ne(i,f,t,b,u,v,N,S,o,g,n),{hiddenFields:B,ToggleUI:L}=oe(r,a,c,b,i),U=G({data:c,setData:a,apiConfig:h,view:b}),z=$=>{$.preventDefault(),console.log("📤 Datos que se enviarán:",c),M($)};return e.jsxs(Y,{className:`bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 ${C?"":m} border-2 ${w}`,children:[e.jsx(q,{children:e.jsxs("div",{className:"flex items-start flex-wrap gap-x-4",children:[e.jsxs("div",{children:[e.jsx(ee,{children:T}),e.jsx(te,{children:R})]}),e.jsx("div",{className:"mt-1",children:e.jsx(L,{})})]})}),e.jsx(se,{children:e.jsxs("form",{onSubmit:x??z,action:route(`${b}.form`,{id:t==null?void 0:t.id,action:i}),method:"POST",className:"space-y-2",encType:"multipart/form-data",children:[e.jsx("div",{className:"flex flex-wrap gap-4",children:e.jsx(W,{formFields:s,data:c,setData:a,errors:k,readonly:d,configReadonly:P,hiddenFields:B,isMobile:C,inputRefs:l,view:b,apiConfig:h,FetchButton:U})}),O]})})]})};export{ue as L};
