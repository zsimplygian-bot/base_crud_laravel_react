import{u as U,r as V,j as e,H as z,a as G}from"./app-CuLuPIef.js";import{A as J}from"./app-layout-D2xkIWDv.js";import{C as K,a as Q,b as X,c as Y,d as Z}from"./card-804OfID0.js";import{u as v}from"./sidebar_cita-BCUTA7y5.js";import{u as w,a as ee,b as se,c as te}from"./use-fetch-with-button-BBvdCbjc.js";import{F as oe}from"./form-fields-DdbNLsGW.js";const fe=({form_data:i,formFields:u,sheetFields:re,action:n,custom_title:g,view:s,title:f,width_form:b="w-full",readonly:S=!1,toggleOptions:C,queryparams:y,apiConfig:p,submitForm:D,debug:d=!1})=>{const{data:t,setData:l,post:N,put:T,delete:E,processing:H,errors:R,recentlySuccessful:$,reset:k}=U(i),A=V.useRef({}),h=v();w({view:s,data:t,setData:l});const{title:B,description:O,cardBorderClass:P,readonly:W,handleSubmit:x,FooterButtons:_}=ee(n,g,i,s,N,T,E,H,$,y),{hiddenFields:q,ToggleUI:F}=se(C,l,t,s,n),I=te({data:t,setData:l,apiConfig:p,view:s}),m=Object.values(t).some(c=>c instanceof File),M=D??(m?c=>{c.preventDefault(),d&&(console.log("📤 Datos que se enviarán:",t),console.log("🔍 ¿Hay archivo?",m));const L=n==="create"?route(`${s}.store`):route(`${s}.update`,{[s]:t.id??t[`id_${s}`]});if(m){const a=new FormData,j=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");if(!j){console.error("❌ No se encontró CSRF token. Verifica <meta name='csrf-token'> en tu layout.");return}if(a.append("_token",j),n!=="create"&&a.append("_method","PATCH"),Object.entries(t).forEach(([r,o])=>{o!=null&&r!=="id"&&r!=="_method"&&(o instanceof File?a.append(r,o):a.append(r,String(o)))}),d){console.log("🔍 Contenido de FormData (orden de append):");for(let[r,o]of a.entries())console.log(r,typeof o=="object"?"[File]":o)}G.post(L,a,{forceFormData:!0,preserveState:!0,preserveScroll:!0,onSuccess:()=>{k()},onError:r=>{l(o=>({...o,errors:r}))}})}else x(c)}:x);return e.jsxs(J,{breadcrumbs:[{title:f,href:s}],children:[e.jsx(z,{title:f}),e.jsx("div",{className:"flex flex-1 flex-col gap-4 p-4 rounded-xl",children:e.jsxs(K,{className:`${h?"w-full":b} border-2 ${P}`,children:[e.jsx(Q,{children:e.jsxs("div",{className:"flex flex-wrap items-start gap-x-4",children:[e.jsxs("div",{children:[e.jsx(X,{children:B}),e.jsx(Y,{children:O})]}),F&&e.jsx("div",{className:"mt-1",children:e.jsx(F,{})})]})}),e.jsxs(Z,{children:[d&&e.jsxs(e.Fragment,{children:[console.log("📋 formFields:",u),console.log("📤 data actual:",t)]}),e.jsxs("form",{onSubmit:M,action:route(`${s}.form`,{id:i?.id,action:n}),method:"POST",className:"space-y-2",encType:"multipart/form-data",children:[e.jsx("div",{className:"flex flex-wrap gap-4",children:e.jsx(oe,{formFields:u,data:t,setData:l,errors:R,readonly:S||W,hiddenFields:q,isMobile:h,inputRefs:A,view:s,apiConfig:p,FetchButton:I})}),_]})]})]})})]})};export{fe as F};
