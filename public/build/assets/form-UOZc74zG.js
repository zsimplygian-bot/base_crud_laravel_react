import{j as e,r as n,u as B,H as V}from"./app-BzWE1med.js";import{D as K,j as Z,k as q,l as J,m as Q,A as X}from"./app-layout-C0QQKrRk.js";import{C as Y,a as ee,b as te,c as se,d as ae}from"./card-BzS6sp8N.js";import{u as oe}from"./sidebar_cita-BPJK5Z2U.js";import{u as re,a as ie,b as le,c as ne}from"./use-fetch-with-button-D34V0cKT.js";import{F as G}from"./form-fields-DUdPzixS.js";import{c as ce,b as de,B as I}from"./button-DjS8Hlcm.js";import{P}from"./pencil-DJgTEY-g.js";import{T as H}from"./trash-DU2nYmAg.js";import{L as pe}from"./loader-circle-BWQtQtoR.js";import{S as ue}from"./trash-2-DEaAqcFp.js";/* empty css            */import"./index-DW9Vsjek.js";import"./index-C9LP8YsR.js";import"./check-BuxMj6jE.js";import"./index-CVASjcgI.js";import"./transition-BtB-gray.js";import"./input-DGneqP3b.js";import"./label-DMQ2Jq4x.js";import"./input-error-BjpIJ63G.js";import"./search-BL3f9Z-4.js";const me=de("flex w-fit items-stretch [&>*]:focus-visible:z-10 [&>*]:focus-visible:relative [&>[data-slot=select-trigger]:not([class*='w-'])]:w-fit [&>input]:flex-1 has-[select[aria-hidden=true]:last-child]:[&>[data-slot=select-trigger]:last-of-type]:rounded-r-md has-[>[data-slot=button-group]]:gap-2",{variants:{orientation:{horizontal:"[&>*:not(:first-child)]:rounded-l-none [&>*:not(:first-child)]:border-l-0 [&>*:not(:last-child)]:rounded-r-none",vertical:"flex-col [&>*:not(:first-child)]:rounded-t-none [&>*:not(:first-child)]:border-t-0 [&>*:not(:last-child)]:rounded-b-none"}},defaultVariants:{orientation:"horizontal"}});function fe({className:a,orientation:c,...d}){return e.jsx("div",{role:"group","data-slot":"button-group","data-orientation":c,className:ce(me({orientation:c}),a),...d})}const k={seguimientos:"SEGUIMIENTO",procedimientos:"PROCEDIMIENTO",medicamentos:"MEDICAMENTO",anamnesis:"ANAMNESIS"},he={create:{title:"REGISTRAR",btn:"Guardar",cls:"bg-blue-600 hover:bg-blue-700 text-white",icon:e.jsx(ue,{className:"w-4 h-4"}),border:"border-l border-blue-500"},update:{title:"ACTUALIZAR",btn:"Actualizar",cls:"bg-green-600 hover:bg-green-700 text-white",icon:e.jsx(P,{className:"w-4 h-4"}),border:"border-l border-green-500"},delete:{title:"ELIMINAR",btn:"Eliminar",cls:"bg-red-600 hover:bg-red-700 text-white",icon:e.jsx(H,{className:"w-4 h-4"}),border:"border-l border-red-500",readonly:!0}},$=a=>a.endsWith("is")?a:a.replace(/s$/,""),L=a=>`id_historia_clinica_${$(a)}`,O=(a,c)=>c?`/historia_clinica_${$(a)}/${c}`:`/historia_clinica_${$(a)}/form`,z=(a,c)=>a.find(d=>d.key.startsWith("id_")||d.label.toLowerCase().includes($(c)))?.value??null,xe=a=>a.charAt(0).toUpperCase()+a.slice(1).toLowerCase();function be({view:a,formId:c,action:d="update"}){const C=d==="update",l=n.useMemo(()=>window.location.pathname.match(/\/update\/(\d+)/)?.[1]??c,[c]),[s,g]=n.useState({open:!1,tipo:null,reg:null,act:"update"}),[m,T]=n.useState({}),[u,j]=n.useState({}),[N,f]=n.useState({}),h=n.useRef({}),{post:w,put:S,delete:v,processing:D,errors:A,setData:F}=B({}),x=n.useCallback(()=>{fetch(`/api/historia/${l}/records`).then(t=>t.json()).then(f).catch(()=>{})},[l]);n.useEffect(x,[x]),n.useEffect(()=>{!s.open||!s.tipo||m[s.tipo]||fetch(`/api/historia/${s.tipo}/fields`).then(t=>t.json()).then(t=>T(o=>({...o,[s.tipo]:Object.entries(t).map(([r,i])=>[r,i.label??r,i.type??"text",i.options??null])})))},[s.open,s.tipo,m]),n.useEffect(()=>{if(!s.open||!s.tipo||!m[s.tipo])return;const t={};m[s.tipo].forEach(([r])=>t[r]=s.reg?.find(i=>i.key===r)?.value??"");const o=s.reg?z(s.reg,s.tipo):null;o&&(t[L(s.tipo)]=o),s.act==="create"&&(t.id_historia_clinica=l),j(t)},[s.open,s.tipo,s.reg,m,l]),n.useEffect(()=>F(u),[u,F]);const R=n.useCallback(t=>{if(t.preventDefault(),!s.tipo)return;const o=u[L(s.tipo)],i={onSuccess:()=>{g(y=>({...y,open:!1})),x()}};s.act==="create"?w(O(s.tipo),{data:u,...i}):s.act==="update"?S(O(s.tipo,o),{data:u,...i}):v(O(s.tipo,o),i)},[s,u,w,S,v,x]),b=(t,o,r)=>g({open:!0,tipo:t,reg:o,act:r}),_=()=>g({open:!1,tipo:null,reg:null,act:"update"}),M=n.useMemo(()=>Object.entries(N).flatMap(([t,o])=>o.map(r=>({k:t,tipo:k[t],f:r,fecha:r.find(i=>i.key==="fecha")?.value??null,id:z(r,t)}))).sort((t,o)=>(t.fecha?+new Date(t.fecha):0)-(o.fecha?+new Date(o.fecha):0)),[N]),p=s.tipo?he[s.act]:null,E=s.tipo?k[s.tipo]:"";return e.jsxs("div",{className:"flex flex-col gap-4",children:[C&&e.jsx(fe,{className:"gap-1 flex flex-wrap",children:Object.keys(k).map(t=>e.jsx(I,{size:"sm",variant:"outline",className:"text-xs font-medium min-w-0 px-2",onClick:()=>b(t,null,"create"),children:xe(k[t])},t))}),M.map(t=>e.jsxs("div",{className:"border rounded-lg p-3 flex justify-between bg-muted/40",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-purple-600 dark:text-purple-400",children:[t.tipo,t.fecha?e.jsxs("span",{className:"ml-2 text-purple-600 dark:text-purple-400",children:["â€” ",new Date(t.fecha).toLocaleDateString("es-PE")]}):e.jsx("span",{className:"ml-2 text-gray-400 dark:text-gray-500",children:"â€” Sin fecha"})]}),t.f.filter(o=>!["id_","fecha","created_at","updated_at"].some(r=>o.key.startsWith(r)||o.key===r)).map((o,r)=>e.jsxs("p",{className:"text-sm",children:[o.label,": ",o.value??"-"]},r))]}),C&&e.jsxs("div",{className:"flex flex-col gap-1 ml-2",children:[e.jsx(I,{size:"icon",variant:"outline",onClick:()=>b(t.k,t.f,"update"),children:e.jsx(P,{className:"w-4 h-4"})}),e.jsx(I,{size:"icon",variant:"destructive",onClick:()=>b(t.k,t.f,"delete"),children:e.jsx(H,{className:"w-4 h-4"})})]})]},`${t.k}-${t.id}`)),e.jsx(K,{open:s.open,onOpenChange:_,children:e.jsxs(Z,{className:`max-w-lg p-6 ${p?.border||""}`,children:[p&&e.jsxs(e.Fragment,{children:[e.jsx(q,{children:e.jsxs(J,{className:"flex items-center gap-2 text-lg font-bold",children:[p.title," ",E]})}),e.jsxs(Q,{className:"sr-only",children:["Formulario para ",p.title.toLowerCase()," ",E.toLowerCase(),"."]})]}),e.jsxs("form",{onSubmit:R,className:"space-y-3",children:[(m[s.tipo??""]??[]).filter(([t])=>t!=="id_historia_clinica").map(([t,o,r,i])=>e.jsx(G,{formFields:{[t]:{form:{key:t,label:o,type:r,options:i}}},data:u,setData:(y,U)=>j(W=>({...W,[y]:U})),errors:A,readonly:p?.readonly,hiddenFields:[],isMobile:!0,inputRefs:h,view:a},t)),e.jsx("div",{className:"flex justify-end",children:e.jsxs(I,{type:"submit",disabled:D,className:`${p?.cls} flex items-center gap-2`,children:[D?e.jsx(pe,{className:"w-4 h-4 animate-spin"}):p?.icon,p?.btn]})})]})]})})]})}const ge=({form_data:a,formFields:c,action:d,custom_title:C,view:l,title:s,width_form:g="w-full",readonly:m=!1,toggleOptions:T,queryparams:u,apiConfig:j,debug:N=!1})=>{const{data:f,setData:h,post:w,put:S,delete:v,processing:D,errors:A,recentlySuccessful:F,reset:x}=B(a),R=n.useRef({}),b=oe();re({view:l,data:f,setData:h});const{title:_,description:M,cardBorderClass:p,readonly:E,handleSubmit:t,FooterButtons:o}=ie(d,C,a,l,w,S,v,D,F,u,f,h,x),{hiddenFields:r,ToggleUI:i}=le(T,h,f,l,d),y=ne({data:f,setData:h,apiConfig:j,view:l});return e.jsxs(X,{breadcrumbs:[{title:s,href:l}],children:[e.jsx(V,{title:s}),e.jsxs("div",{className:"flex flex-1 flex-col gap-4 p-4 rounded-xl",children:[e.jsxs(Y,{className:`${b?"w-full":g} border-2 ${p}`,children:[e.jsx(ee,{children:e.jsxs("div",{className:"flex flex-wrap items-start gap-x-4",children:[e.jsxs("div",{children:[e.jsx(te,{children:_}),e.jsx(se,{children:M})]}),i&&e.jsx("div",{className:"mt-1",children:e.jsx(i,{})})]})}),e.jsxs(ae,{children:[N&&e.jsxs(e.Fragment,{children:[console.log("ðŸ“‹ formFields:",c),console.log("ðŸ“¤ data actual:",f)]}),e.jsxs("form",{onSubmit:t,action:route(`${l}.form`,{id:a?.id,action:d}),method:"POST",className:"space-y-2",encType:"multipart/form-data",children:[e.jsx("div",{className:"flex flex-wrap gap-4",children:e.jsx(G,{formFields:c,data:f,setData:h,errors:A,readonly:m||E,hiddenFields:r,isMobile:b,inputRefs:R,view:l,apiConfig:j,FetchButton:y})}),o]})]})]}),d!=="create"&&e.jsx(be,{view:l,action:d,formId:a?.[`id_${l}`],debug:N})]})]})};function Be(a){return e.jsx(ge,{...a})}export{Be as default};
