import{r as n,j as e,a as Q,u as oe,H as ie}from"./app-CuLuPIef.js";import{D as X,j as Y,k as Z,l as ee,A as ae}from"./app-layout-D2xkIWDv.js";import{C as ne,a as le,b as ce,c as de,d as me}from"./card-804OfID0.js";import{u as pe}from"./sidebar_cita-BCUTA7y5.js";import{u as ue,a as fe,b as xe,c as he}from"./use-fetch-with-button-BBvdCbjc.js";import{F as se}from"./form-fields-DdbNLsGW.js";import{B as g}from"./button-CTUbhxhW.js";import{P as ge}from"./search-CRMw4Q9t.js";import{P as je}from"./pencil-D1MI2pub.js";import{T as be}from"./trash-C-6D-96G.js";/* empty css            */import"./index-Ck_whzGL.js";import"./index-CtIkYhm7.js";import"./check-xHDdzXmd.js";import"./index-CVASjcgI.js";import"./loader-circle-CUHP0cQj.js";import"./trash-2-e8DASLTN.js";import"./transition-BlJ8vDVC.js";import"./input-DMUFlbOG.js";import"./label-BjaghfFZ.js";import"./input-error-BI_9qHMN.js";const J={seguimiento:"seguimientos",procedimiento:"procedimientos",medicamento:"medicamentos",anamnesis:"anamnesis"};function ye({view:m,formId:B,action:H="view",seguimientos:C=[],procedimientos:S=[],medicamentos:A=[],anamnesis:p=[],modalFields:D=[],procedimientoFields:i=[],medicamentoFields:b=[],anamnesisFields:v=[]}){const[r,f]=n.useState({open:!1,registro:null,tipo:null}),[c,x]=n.useState({open:!1,registro:null,tipo:""}),[_,M]=n.useState({}),[z,w]=n.useState({}),K=n.useRef({}),l=t=>Array.isArray(t)?t:t&&typeof t=="object"?Object.entries(t).map(([s,o])=>[s,o.label??s.toUpperCase(),o.type??"text",o.options??null,o.width??1]):[],u=n.useMemo(()=>l(D),[D]),y=n.useMemo(()=>l(i),[i]),F=n.useMemo(()=>l(b),[b]),N=n.useMemo(()=>l(v),[v]),L=n.useMemo(()=>[...p.map(s=>({...s,tipo:"Anamnesis",fields:N})),...C.map(s=>({...s,tipo:"Seguimiento",fields:u})),...S.map(s=>({...s,tipo:"Procedimiento",fields:y})),...A.map(s=>({...s,tipo:"Medicamento",fields:F}))].sort((s,o)=>new Date(s.created_at).getTime()-new Date(o.created_at).getTime()),[p,C,S,A]),j=n.useMemo(()=>{switch(r.tipo){case"procedimientos":return y;case"medicamentos":return F;case"anamnesis":return N;default:return u}},[r.tipo,y,F,N,u]),U=n.useMemo(()=>{const t={};return j.forEach(s=>{Array.isArray(s)&&s[0]&&(t[s[0]]={form:{key:s[0],label:s[1],type:s[2],options:s[3],placeholder:"",width:1}})}),t},[j]);n.useEffect(()=>{if(!r.open)return;w({});const t={};j.forEach(s=>{Array.isArray(s)&&s[0]&&(t[s[0]]=r.registro?.[s[0]]??"")}),M(t)},[r.open,r.registro,j]);const $=(t,s)=>{const o=s==="anamnesis"?s:s.replace(/s$/,"");return[t[`id_historia_clinica_${o}`],t[`id_${o}`],t.id].find(d=>d!=null)},W=t=>{if(t.preventDefault(),!r.tipo)return;const s=r.tipo==="anamnesis"?"anamnesis":r.tipo.replace(/s$/,""),o=`${m}.${J[s]??"anamnesis"}`,a=r.registro?$(r.registro,r.tipo):null,d=r.registro?route(`${o}.update`,{[s]:a}):route(`${o}.store`),h={..._,id_historia_clinica:B};Q[r.registro?"put":"post"](d,{data:h,onError:w,onSuccess:()=>f({open:!1,registro:null,tipo:null})})},E=()=>{if(!c.registro)return;const t=c.tipo==="anamnesis"?"anamnesis":c.tipo.replace(/s$/,""),s=`${m}.${J[t]??"anamnesis"}`,o=$(c.registro,c.tipo);if(!o)return;const a=route(`${s}.destroy`,{[t]:o});Q.delete(a,{onSuccess:()=>x({open:!1,registro:null,tipo:""})})},k=H==="update";return e.jsxs("div",{className:"flex flex-col gap-4 mt-0",children:[k&&e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries({anamnesis:"Anamnesis",seguimientos:"Seguimiento",procedimientos:"Procedimiento",medicamentos:"Medicamento"}).map(([t,s])=>e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>f({open:!0,registro:null,tipo:t}),children:[e.jsx(ge,{className:"w-4 h-4 mr-1"})," ",s]},t))}),L.map(t=>{const s=J[t.tipo.toLowerCase()]||"anamnesis",o=$(t,s);return e.jsxs("div",{className:"p-3 rounded-lg border bg-gray-50 dark:bg-gray-900 flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-semibold text-gray-800 dark:text-white",children:[t.tipo," — ",t.fecha]}),Array.isArray(t.fields)&&t.fields.filter(a=>Array.isArray(a)&&a[0]!=="fecha").map((a,d)=>{const h=a[0],T=a[1];let R=t[h]??"-";if(/^id_/.test(h)){const P=h.replace(/^id_/,"nombre_");t[P]!==void 0&&t[P]!==null&&(R=t[P])}return e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:[T,": ",R]},d)})]}),k&&e.jsxs("div",{className:"flex flex-col gap-1 ml-2",children:[e.jsx(g,{size:"icon",variant:"outline",onClick:()=>f({open:!0,registro:t,tipo:s}),children:e.jsx(je,{className:"w-4 h-4"})}),e.jsx(g,{size:"icon",variant:"destructive",onClick:()=>x({open:!0,registro:t,tipo:s}),children:e.jsx(be,{className:"w-4 h-4"})})]})]},`${t.tipo}-${o}`)}),r.open&&e.jsx(X,{open:r.open,onOpenChange:()=>f({open:!1,registro:null,tipo:null}),children:e.jsxs(Y,{className:"max-w-lg w-full",children:[e.jsx(Z,{children:e.jsx(ee,{children:r.registro?`Editar ${r.tipo?.replace(/s$/,"")}`:`Nuevo ${r.tipo?.replace(/s$/,"")}`})}),e.jsxs("form",{onSubmit:W,className:"space-y-3 w-full",children:[e.jsx("div",{className:"flex flex-col gap-3",children:Object.entries(U).map(([t,s])=>e.jsx("div",{className:"w-full",children:e.jsx(se,{formFields:{[t]:s},data:_,setData:(o,a)=>M(d=>({...d,[o]:a})),errors:z,readonly:!1,configReadonly:!1,hiddenFields:[],isMobile:!0,inputRefs:K,view:m})},t))}),e.jsxs("div",{className:"flex justify-end gap-2 pt-3",children:[e.jsx(g,{type:"button",variant:"outline",onClick:()=>f({open:!1,registro:null,tipo:null}),children:"Cancelar"}),e.jsx(g,{type:"submit",children:"Guardar"})]})]})]})}),c.open&&e.jsx(X,{open:c.open,onOpenChange:()=>x({open:!1,registro:null,tipo:""}),children:e.jsxs(Y,{className:"max-w-md w-full",children:[e.jsx(Z,{children:e.jsxs(ee,{children:["¿Eliminar ",c.registro?.tipo??"registro","?"]})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-3",children:[e.jsx(g,{variant:"outline",onClick:()=>x({open:!1,registro:null,tipo:""}),children:"Cancelar"}),e.jsx(g,{variant:"destructive",onClick:E,children:"Eliminar"})]})]})})]})}const Fe=({form_data:m,formFields:B,modalFields:H=[],procedimientoFields:C=[],medicamentoFields:S=[],anamnesisFields:A=[],action:p,custom_title:D,view:i,title:b,width_form:v="w-full",readonly:r=!1,toggleOptions:f,queryparams:c,apiConfig:x,seguimientos:_=[],procedimientos:M=[],medicamentos:z=[],anamnesis:w=[],debug:K=!1})=>{const{data:l,setData:u,post:y,put:F,delete:N,processing:L,errors:j,recentlySuccessful:U,reset:$}=oe(m),W=n.useRef({}),E=pe();ue({view:i,data:l,setData:u});const{title:k,description:t,cardBorderClass:s,readonly:o,handleSubmit:a,FooterButtons:d}=fe(p,D,m,i,y,F,N,L,U,c),{hiddenFields:h,ToggleUI:T}=xe(f,u,l,i,p),R=he({data:l,setData:u,apiConfig:x,view:i}),te=Object.values(l).some(q=>q instanceof File)?q=>{q.preventDefault();const re=p==="create"?route(`${i}.store`):route(`${i}.update`,{[i]:l.id??l[`id_${i}`]}),O=new FormData,V=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");V&&(O.append("_token",V),p!=="create"&&O.append("_method","PATCH"),Object.entries(l).forEach(([G,I])=>{I!=null&&G!=="id"&&G!=="_method"&&O.append(G,I instanceof File?I:String(I))}),Q.post(re,O,{forceFormData:!0,preserveState:!0,preserveScroll:!0,onSuccess:()=>$()}))}:a;return e.jsxs(ae,{breadcrumbs:[{title:b,href:i}],children:[e.jsx(ie,{title:b}),e.jsxs("div",{className:"flex flex-1 flex-col gap-4 p-4 rounded-xl",children:[e.jsxs(ne,{className:`${E?"w-full":v} border-2 ${s}`,children:[e.jsx(le,{children:e.jsxs("div",{className:"flex flex-wrap items-start gap-x-4",children:[e.jsxs("div",{children:[e.jsx(ce,{children:k}),e.jsx(de,{children:t})]}),T&&e.jsx("div",{className:"mt-1",children:e.jsx(T,{})})]})}),e.jsx(me,{children:e.jsxs("form",{onSubmit:te,encType:"multipart/form-data",className:"space-y-2",children:[e.jsx("div",{className:"flex flex-wrap gap-4",children:e.jsx(se,{formFields:B,data:l,setData:u,errors:j,readonly:r||o,hiddenFields:h,isMobile:E,inputRefs:W,view:i,apiConfig:x,FetchButton:R})}),d]})})]}),p!=="create"&&e.jsx(ye,{view:i,action:p,formId:m?.[`id_${i}`],seguimientos:_,procedimientos:M,medicamentos:z,anamnesis:w,modalFields:H,procedimientoFields:C,medicamentoFields:S,anamnesisFields:A,debug:K})]})]})};function Ue(m){return e.jsx(Fe,{...m})}export{Ue as default};
