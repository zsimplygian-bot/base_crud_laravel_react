import{j as e,r as g,$ as I,m as _,L as H}from"./app-CX3vRXLx.js";import{u as V,A as D}from"./app-layout-m4MDTwBO.js";import{a as E,c as y,B as j}from"./button-CXMDOt1C.js";import{z as G}from"./transition-DPOTKLNf.js";import{S as W,u as Q,F as Z}from"./form-fields-DpU3dUl7.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],K=E("ArrowLeft",J);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],A=E("Save",X);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],q=E("Trash2",Y);function ee({className:t,...s}){return e.jsx("div",{"data-slot":"card",className:y("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...s})}function te({className:t,...s}){return e.jsx("div",{"data-slot":"card-header",className:y("flex flex-col gap-1.5 px-6",t),...s})}function se({className:t,...s}){return e.jsx("div",{"data-slot":"card-title",className:y("leading-none font-semibold",t),...s})}function re({className:t,...s}){return e.jsx("div",{"data-slot":"card-description",className:y("text-muted-foreground text-sm",t),...s})}function oe({className:t,...s}){return e.jsx("div",{"data-slot":"card-content",className:y("px-6",t),...s})}function ne({view:t,data:s,setData:o}){const a=g.useRef(!1);g.useEffect(()=>{if(t!=="liquidacion")return;const x=parseFloat(s.valor??"");let d=parseFloat(s.porcentaje??"");parseInt(s.id_tipo_liquid)===1&&parseInt(s.nrorev)===1&&(d*=4);const h=d/100,l=parseFloat(s.tasamin??""),f=parseFloat(s.tasamax??""),r=parseFloat(s.igv??"");if(!(!isNaN(x)&&!isNaN(h))){o("porcenaplica",""),o("igvporcen",""),o("subtotal",""),o("total","");return}const p=x*h;o("porcenaplica",p.toFixed(2));const u=isNaN(r)?0:p/100*r;o("igvporcen",u.toFixed(2));const i=p+u;o("subtotal",i.toFixed(2));let b=i;isNaN(l)||(b=Math.max(b,l)),!isNaN(f)&&f>0&&(b=Math.min(b,f)),o("total",b.toFixed(2)),a.current=!0},[t,s.valor,s.porcentaje,s.igv,s.tasamin,s.tasamax,s.id_tipo_liquid,s.nrorev])}function ae(t,s,o,a,x){var k;if(!((k=t==null?void 0:t.values)!=null&&k.length))return{activeOption:"",hiddenFields:[],ToggleUI:()=>null};const{label:d,values:h,fields:l}=t,f=x==="info"||x==="delete",r=g.useCallback(()=>h.find(n=>(l[n]||[]).some(c=>o[c]!=null&&o[c]!==""))||h[0],[o,l,h]),[m,p]=g.useState(()=>r()),[u,i]=g.useState(!1),b=g.useCallback(n=>{if(a==="tasaliquid")return;const c=new Set(l[n]||[]);Object.values(l).flat().forEach(T=>{c.has(T)||s(T,"")})},[l,s,a]);g.useEffect(()=>{if(u)return;const n=r();n!==m&&(p(n),b(n))},[o,u,m,r,b]);const v=g.useCallback(n=>{n!==m&&(i(!0),p(n),b(n))},[m,b]),N=g.useMemo(()=>{const n=new Set(l[m]||[]);return Object.values(l).flat().filter(c=>!n.has(c))},[l,m]);return{activeOption:m,hiddenFields:N,ToggleUI:()=>e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-medium",children:[d,":"]}),h.map(n=>e.jsx(j,{type:"button",variant:m===n?"default":"outline",onClick:()=>v(n),disabled:f,children:n},n))]})}}const F={create:{formAction:"store",method:"POST",buttonText:"Registrar",buttonClass:"bg-blue-500 hover:bg-blue-600 text-white dark:bg-blue-700 dark:hover:bg-blue-600",borderColor:"border-blue-200 dark:border-blue-950",description:"Ingresa los datos cuidadosamente.",titlePrefix:"REGISTRO DE",showSubmitButton:t=>e.jsxs(j,{disabled:t,type:"submit",className:F.create.buttonClass,children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),"Registrar"]})},update:{formAction:"update",method:"PUT",buttonText:"Actualizar",buttonClass:"bg-green-600 hover:bg-green-500 text-white dark:bg-green-700 dark:hover:bg-green-600",borderColor:"border-green-200 dark:border-green-950",description:"Actualiza los datos con cuidado.",titlePrefix:"ACTUALIZAR",showSubmitButton:t=>e.jsxs(j,{disabled:t,type:"submit",className:F.update.buttonClass,children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),"Actualizar"]})},delete:{formAction:"destroy",method:"DELETE",buttonText:"Eliminar",buttonClass:"bg-red-700 hover:bg-red-800 text-white dark:bg-red-800 dark:hover:bg-red-700",borderColor:"border-red-200 dark:border-red-950",description:"¿Estás seguro que deseas eliminar? Esta acción es irreversible.",titlePrefix:"ELIMINAR",readonly:!0,showSubmitButton:t=>e.jsxs(j,{disabled:t,type:"submit",className:F.delete.buttonClass,children:[e.jsx(q,{className:"mr-2 h-4 w-4"}),"Eliminar"]})},review:{formAction:"store",method:"POST",buttonText:"Revisar",buttonClass:"bg-purple-500 hover:bg-purple-700 text-white dark:bg-purple-500 dark:hover:bg-purple-600",borderColor:"border-purple-300 dark:border-purple-900",description:"Revisa los datos cuidadosamente.",titlePrefix:"REVISAR",readonly:!0,showSubmitButton:t=>e.jsxs(j,{disabled:t,type:"submit",className:F.review.buttonClass,children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),"Registrar"]})},info:{formAction:"info",method:"POST",buttonText:"",buttonClass:"bg-gray-500 hover:bg-gray-600 text-white dark:bg-gray-400 dark:hover:bg-gray-500",borderColor:"border-gray-200 dark:border-gray-800",description:"Consulta la información.",titlePrefix:"INFORMACIÓN DE",readonly:!0,showSubmitButton:()=>null}},ie=(t,s,o,a,x,d,h,l,f,r,m)=>g.useMemo(()=>{const p=t||"create",u=F[p];let i;if(o[`id_${a}`])i=o[`id_${a}`];else if(a==="itemsimple"){let c="";typeof r=="string"?c=r:typeof r=="object"&&(r!=null&&r.tipo)&&(c=String(r.tipo)),c&&o[`id_${c}`]&&(i=o[`id_${c}`])}!i&&p!=="create"&&console.warn(`⚠️ No se encontró formDataId. Intentado: id_${a}`+(a==="itemsimple"&&r?`, id_${typeof r=="string"?r:r.tipo}`:""));const b=`${a}.${u.formAction}`,v=typeof r=="string"?{tipo:r}:r?Object.fromEntries(Object.entries(r).map(([c,C])=>[c,String(C)])):{},N=Object.keys(v).length>0?"?"+new URLSearchParams(v).toString():"",S=`${u.titlePrefix} ${s.toUpperCase()}`,k=c=>{switch(c.preventDefault(),u.method){case"POST":x(route(b));break;case"PUT":i&&d(route(b,i));break;case"DELETE":i&&h(route(b,i));break}},n=a==="tasaliquid"?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(I,{href:`/../${a}${N}`,children:e.jsxs(j,{variant:"outline",children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Regresar"]})}),e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsx(G,{show:f,enter:"transition ease-in-out",enterFrom:"opacity-0",leave:"transition ease-in-out",leaveTo:"opacity-0",children:e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:"Guardado"})}),u.showSubmitButton(l),m&&p==="update"&&i&&e.jsx(I,{href:`/${a}/form/review/${i}${N}`,children:e.jsxs(j,{type:"button",className:"bg-purple-600 hover:bg-purple-700 text-white dark:bg-purple-500 dark:hover:bg-purple-600",children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),"Revisar"]})})]})]});return{...u,title:S,handleSubmit:k,FooterButtons:n}},[t,s,o,a,x,d,h,l,f,r,m]),le=({form_data:t,formFields:s,sheetFields:o,action:a,custom_title:x,view:d,width_form:h="w-full",readonly:l=!1,queryparams:f,toggleOptions:r,submitForm:m,apiConfig:p})=>{const{data:u,setData:i,post:b,put:v,delete:N,processing:S,errors:k,recentlySuccessful:n}=_(t),c=g.useRef({}),C=V();ne({view:d,data:u,setData:i});const{title:T,description:R,borderColor:P,readonly:w,handleSubmit:M,FooterButtons:O}=ie(a,x,t,d,b,v,N,S,n,f,o),{hiddenFields:L,ToggleUI:B}=ae(r,i,u,d,a),U=Q({data:u,setData:i,apiConfig:p,view:d}),z=$=>{$.preventDefault(),console.log("📤 Datos que se enviarán:",u),M($)};return e.jsxs(ee,{className:`${C?"":h} border-2 ${P}`,children:[e.jsx(te,{children:e.jsxs("div",{className:"flex items-start flex-wrap gap-x-4",children:[e.jsxs("div",{children:[e.jsx(se,{children:T}),e.jsx(re,{children:R})]}),e.jsx("div",{className:"mt-1",children:e.jsx(B,{})})]})}),e.jsx(oe,{children:e.jsxs("form",{onSubmit:m??z,action:route(`${d}.form`,{id:t==null?void 0:t.id,action:a}),method:"POST",className:"space-y-2",encType:"multipart/form-data",children:[e.jsx("div",{className:"flex flex-wrap gap-4",children:e.jsx(Z,{formFields:s,data:u,setData:i,errors:k,readonly:l,configReadonly:w,hiddenFields:L,isMobile:C,inputRefs:c,view:d,apiConfig:p,FetchButton:U})}),O]})})]})},he=({form_data:t,formFields:s,action:o,custom_title:a,view:x,title:d,queryparams:h,width_form:l,toggleOptions:f,apiConfig:r})=>(console.log("Form Component Props:",{view:x,apiConfig:r,formFields:s}),e.jsxs(D,{breadcrumbs:[{title:d,href:x}],children:[e.jsx(H,{title:d}),e.jsx("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:e.jsx(le,{form_data:t,formFields:s,action:o,custom_title:a,view:x,width_form:l,queryparams:h,toggleOptions:f,apiConfig:r})})]}));export{he as F};
