import{r as p,j as r,L as $}from"./app-CuLuPIef.js";import{B as T}from"./button-CTUbhxhW.js";import{S as F,T as O,A as k}from"./trash-2-e8DASLTN.js";import{z as S}from"./transition-BlJ8vDVC.js";import{L as P}from"./loader-circle-CUHP0cQj.js";function z({view:d,data:t,setData:e}){const c=p.useRef(!1);p.useEffect(()=>{if(d!=="liquidacion")return;const h=parseFloat(t.valor??"");let x=parseFloat(t.porcentaje??"");parseInt(t.id_tipo_liquid)===1&&parseInt(t.nrorev)===1&&(x*=4);const m=x/100,i=parseFloat(t.tasamin??""),l=parseFloat(t.tasamax??""),o=parseFloat(t.igv??"");if(!(!isNaN(h)&&!isNaN(m))){e("porcenaplica",""),e("igvporcen",""),e("subtotal",""),e("total","");return}const s=h*m;e("porcenaplica",s.toFixed(2));const u=isNaN(o)?0:s/100*o;e("igvporcen",u.toFixed(2));const b=s+u;e("subtotal",b.toFixed(2));let f=b;isNaN(i)||(f=Math.max(f,i)),!isNaN(l)&&l>0&&(f=Math.min(f,l)),e("total",f.toFixed(2)),c.current=!0},[d,t.valor,t.porcentaje,t.igv,t.tasamin,t.tasamax,t.id_tipo_liquid,t.nrorev])}function _(d,t,e,c,h){if(!d?.values?.length)return{activeOption:"",hiddenFields:[],ToggleUI:()=>null};const{label:x,values:m,fields:i}=d,l=h==="info"||h==="delete",o=p.useCallback(()=>m.find(a=>(i[a]||[]).some(g=>e[g]!=null&&e[g]!==""))||m[0],[e,i,m]),[n,s]=p.useState(()=>o()),[u,b]=p.useState(!1),f=p.useCallback(a=>{if(c==="tasaliquid")return;const g=new Set(i[a]||[]);Object.values(i).flat().forEach(y=>{g.has(y)||t(y,"")})},[i,t,c]);p.useEffect(()=>{if(u)return;const a=o();a!==n&&(s(a),f(a))},[e,u,n,o,f]);const j=p.useCallback(a=>{a!==n&&(b(!0),s(a),f(a))},[n,f]),N=p.useMemo(()=>{const a=new Set(i[n]||[]);return Object.values(i).flat().filter(g=>!a.has(g))},[i,n]);return{activeOption:n,hiddenFields:N,ToggleUI:()=>r.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[r.jsxs("span",{className:"text-sm font-medium",children:[x,":"]}),m.map(a=>r.jsx(T,{type:"button",variant:n===a?"default":"outline",onClick:()=>j(a),disabled:l,children:a},a))]})}}const R={create:{formAction:"store",method:"POST",buttonText:"Registrar",buttonClass:"bg-blue-500 hover:bg-blue-600 text-white",buttonIcon:r.jsx(F,{className:"w-4 h-4"}),description:"Ingresa los datos cuidadosamente.",titlePrefix:"REGISTRO DE"},update:{formAction:"update",method:"PUT",buttonText:"Actualizar",buttonClass:"bg-green-600 hover:bg-green-500 text-white",buttonIcon:r.jsx(F,{className:"w-4 h-4"}),description:"Actualiza los datos con cuidado.",titlePrefix:"ACTUALIZAR"},delete:{formAction:"destroy",method:"DELETE",buttonText:"Eliminar",buttonClass:"bg-red-500 hover:bg-red-700 text-white destructive",buttonIcon:r.jsx(O,{className:"w-4 h-4"}),description:"Â¿EstÃ¡s seguro que deseas eliminar? Esta acciÃ³n es irreversible.",titlePrefix:"ELIMINAR",readonly:!0},info:{formAction:"info",method:"POST",buttonText:"",buttonClass:"bg-gray-500 hover:bg-gray-600 text-white",buttonIcon:r.jsx(F,{className:"w-4 h-4"}),description:"Consulta la informaciÃ³n.",titlePrefix:"INFORMACIÃ“N DE",readonly:!0}},w=(d,t,e)=>d[`id_${t}`]??(t==="itemsimple"&&e?.tipo?d[`id_${e.tipo}`]:void 0),V=(d,t,e,c,h,x,m,i,l,o)=>p.useMemo(()=>{const n=d||"create",s=R[n],u=w(e,c,o);let b=t;(b.endsWith("s")||b.endsWith("S"))&&(b=b.slice(0,-1));const f=`${s.titlePrefix} ${b.toUpperCase()}`,j=n==="delete",N=typeof o=="string"?`?tipo=${o}`:o?`?${new URLSearchParams(Object.entries(o).map(([v,E])=>[v,String(E)])).toString()}`:"",a={create:"border-blue-300 dark:border-blue-900",update:"border-green-300 dark:border-green-900",delete:"border-red-300 dark:border-red-900",info:"border-gray-300 dark:border-gray-700"}[n],g=v=>{switch(v.preventDefault(),s.method){case"POST":h(route(`${c}.${s.formAction}`));break;case"PUT":u&&x(route(`${c}.${s.formAction}`,u));break;case"DELETE":u&&m(route(`${c}.${s.formAction}`,u));break}},I=()=>s.buttonText?r.jsxs(T,{size:"sm",type:"submit",disabled:i,className:`${s.buttonClass} flex items-center gap-2`,children:[i?r.jsx(P,{className:"w-4 h-4 animate-spin"}):s.buttonIcon,s.buttonText]}):null,y=r.jsxs("div",{className:"flex items-center justify-between mt-4",children:[r.jsx($,{href:`/${c}${N}`,children:r.jsxs(T,{size:"sm",variant:"outline",children:[r.jsx(k,{className:"w-4 h-4"})," Regresar"]})}),r.jsxs("div",{className:"flex items-center gap-x-4",children:[r.jsx(S,{show:l,enter:"transition ease-in-out",enterFrom:"opacity-0",leave:"transition ease-in-out",leaveTo:"opacity-0",children:r.jsx("p",{className:`text-sm ${j?"text-red-600":"text-neutral-600"} dark:text-neutral-400`,children:"Guardado"})}),r.jsx(I,{})]})]});return{config:s,title:f,isDestructive:j,description:s.description,readonly:s.readonly||!1,handleSubmit:g,FooterButtons:y,formDataId:u,cardBorderClass:a}},[d,t,e,c,h,x,m,i,l,o]);function G({data:d,setData:t,apiConfig:e,view:c}){if(!e)return null;const h=p.useRef(null),x=async()=>{const l=d[e.inputKey]?.trim();if(!l)return alert("El campo no puede estar vacÃ­o");try{const n=await(await fetch(`undefined/${e.endpoint}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({[e.inputKey]:l})})).json();console.log(`[${c}] Respuesta API texto:`,n),Object.entries(e.fields).forEach(([s,u])=>t(s,n[u]??e.emptyValue))}catch(o){console.error(`[${c}]`,o),Object.keys(e.fields).forEach(n=>t(n,e.emptyValue))}},m=async l=>{if(!l)return;const o=new FormData;o.append("imagen",l);try{const s=await(await fetch(`undefined/${e.endpoint}`,{method:"POST",body:o})).json();console.log(`[${c}] Respuesta API imagen:`,s),Object.entries(e.fields).forEach(([u,b])=>t(u,s[b]??e.emptyValue))}catch(n){console.error(`[${c}]`,n),Object.keys(e.fields).forEach(s=>t(s,e.emptyValue))}};return({fieldKey:l})=>l!==e.inputKey?null:e.type==="file"?r.jsxs(r.Fragment,{children:[r.jsx("input",{type:"file",ref:h,className:"hidden",accept:"image/*",onChange:o=>{const n=o.target.files?.[0];n&&m(n)}}),r.jsx("button",{type:"button",className:"px-2 py-1 bg-blue-200 rounded hover:bg-blue-300 ml-1",onClick:()=>h.current?.click(),children:"ğŸ“‚ Buscar imagen"})]}):e.type==="text"?r.jsx("button",{type:"button",className:"px-2 py-1 bg-gray-200 rounded hover:bg-gray-300 ml-1",onClick:x,children:"ğŸ”"}):null}export{V as a,_ as b,G as c,z as u};
