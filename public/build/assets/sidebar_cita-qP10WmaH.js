import{r as o,j as t,a as f}from"./app-LkGyvLMc.js";import{t as g,a as h,S as m}from"./index-DIVBszPg.js";import{u as y}from"./use-api-B3SJLi-i.js";import{C as c}from"./clock-DeGV6HIK.js";import{P as j,C as b}from"./pen-DoEh3s02.js";/* empty css            */import"./button-BE9hau6w.js";import"./index-DY0tlTNJ.js";import"./index-7_XKZbta.js";import"./loader-circle-DADD3-El.js";const C=[{max:0,type:"error",label:"hoy"},{max:1,type:"warning",label:"mañana"},{max:3,type:"info",label:"en pocos días"}],N=(i,e)=>{const s=C.find(a=>i<=a.max);return s?{type:s.type,msg:`Cita con ${e.mascota} (${e.cliente}) es ${s.label}`}:null};function v(i){const{data:e}=y(`${i}/api/citas/proximas`,{autoFetch:!0,method:"GET",initialData:[]}),s=o.useRef(new Set),a=o.useMemo(()=>{if(!Array.isArray(e)||e.length===0)return[];const r=new Date;return r.setHours(0,0,0,0),e.map(n=>{const[d,p,x]=n.fecha.split("-").map(Number),u=new Date(d,p-1,x),l=Math.floor((u-r)/864e5);return{...n,diffDays:l,alert:N(l,n),displayDate:`${n.fecha} ${n.hora.slice(0,5)}`}})},[e]);return o.useEffect(()=>{for(const r of a)r.alert&&!s.current.has(r.id)&&(g[r.alert.type](r.alert.msg),s.current.add(r.id))},[a]),a}const D=o.memo(function({cita:e,baseUrl:s}){const a=o.useCallback(()=>{f.post(`${s}/cita/atender/${e.id}`)},[s,e.id]);return t.jsxs("div",{className:"flex items-center justify-between px-2 py-2 rounded-md select-none",children:[t.jsxs("div",{className:"flex-1 flex flex-col",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx(c,{className:"w-4 h-4 text-blue-500"}),t.jsx("span",{className:"font-medium text-sm truncate",children:e.mascota}),t.jsxs("span",{className:"text-xs text-muted-foreground",children:["— ",e.cliente]})]}),t.jsxs("div",{className:"text-xs",children:[e.motivo_cita," — ",e.displayDate]})]}),t.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[t.jsx(m,{to:`${s}/cita/form/update/${e.id}`,icon:j,variant:"ghost",tooltip:"Editar",className:"text-green-600"}),t.jsx(m,{icon:b,tooltip:"Atender",variant:"ghost",onClick:a,className:"text-blue-600"})]})]})});function U(){const e=v(""),s=o.useMemo(()=>e.length===0?[{custom:t.jsx("div",{className:"text-xs text-muted-foreground px-2 py-1",children:"Sin citas próximas"})}]:e.map(a=>({custom:t.jsx(D,{cita:a,baseUrl:""},a.id)})),[e,""]);return t.jsx(h,{label:"Citas próximas",triggerVariant:"ghost",closeOnSelect:!1,triggerIcon:c,triggerBadge:e.length?String(e.length):void 0,triggerBadgeClassName:"bg-red-600 text-white",items:s})}export{U as default};
