import{r as h,j as o,L as B,a as w}from"./app-CNdPgeJ0.js";import{B as S}from"./button-dZ1d1pq1.js";import{S as O,T as L,A as z}from"./trash-2-DpqQgrjM.js";import{z as M}from"./transition-BBoxljtJ.js";import{L as U}from"./loader-circle-Dey-pPjf.js";function W({view:u,data:t,setData:e}){const c=h.useRef(!1);h.useEffect(()=>{if(u!=="liquidacion")return;const f=parseFloat(t.valor??"");let x=parseFloat(t.porcentaje??"");parseInt(t.id_tipo_liquid)===1&&parseInt(t.nrorev)===1&&(x*=4);const m=x/100,i=parseFloat(t.tasamin??""),l=parseFloat(t.tasamax??""),s=parseFloat(t.igv??"");if(!(!isNaN(f)&&!isNaN(m))){e("porcenaplica",""),e("igvporcen",""),e("subtotal",""),e("total","");return}const d=f*m;e("porcenaplica",d.toFixed(2));const p=isNaN(s)?0:d/100*s;e("igvporcen",p.toFixed(2));const b=d+p;e("subtotal",b.toFixed(2));let r=b;isNaN(i)||(r=Math.max(r,i)),!isNaN(l)&&l>0&&(r=Math.min(r,l)),e("total",r.toFixed(2)),c.current=!0},[u,t.valor,t.porcentaje,t.igv,t.tasamin,t.tasamax,t.id_tipo_liquid,t.nrorev])}function Z(u,t,e,c,f){if(!u?.values?.length)return{activeOption:"",hiddenFields:[],ToggleUI:()=>null};const{label:x,values:m,fields:i}=u,l=f==="info"||f==="delete",s=h.useCallback(()=>m.find(a=>(i[a]||[]).some(g=>e[g]!=null&&e[g]!==""))||m[0],[e,i,m]),[n,d]=h.useState(()=>s()),[p,b]=h.useState(!1),r=h.useCallback(a=>{if(c==="tasaliquid")return;const g=new Set(i[a]||[]);Object.values(i).flat().forEach(v=>{g.has(v)||t(v,"")})},[i,t,c]);h.useEffect(()=>{if(p)return;const a=s();a!==n&&(d(a),r(a))},[e,p,n,s,r]);const F=h.useCallback(a=>{a!==n&&(b(!0),d(a),r(a))},[n,r]),E=h.useMemo(()=>{const a=new Set(i[n]||[]);return Object.values(i).flat().filter(g=>!a.has(g))},[i,n]);return{activeOption:n,hiddenFields:E,ToggleUI:()=>o.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[o.jsxs("span",{className:"text-sm font-medium",children:[x,":"]}),m.map(a=>o.jsx(S,{type:"button",variant:n===a?"default":"outline",onClick:()=>F(a),disabled:l,children:a},a))]})}}const _={create:{formAction:"store",method:"POST",buttonText:"Registrar",buttonClass:"bg-blue-500 hover:bg-blue-600 text-white",buttonIcon:o.jsx(O,{className:"w-4 h-4"}),description:"Ingresa los datos cuidadosamente.",titlePrefix:"REGISTRO DE"},update:{formAction:"update",method:"PATCH",buttonText:"Actualizar",buttonClass:"bg-green-600 hover:bg-green-500 text-white",buttonIcon:o.jsx(O,{className:"w-4 h-4"}),description:"Actualiza los datos con cuidado.",titlePrefix:"ACTUALIZAR"},delete:{formAction:"destroy",method:"DELETE",buttonText:"Eliminar",buttonClass:"bg-red-500 hover:bg-red-700 text-white destructive",buttonIcon:o.jsx(L,{className:"w-4 h-4"}),description:"Â¿EstÃ¡s seguro que deseas eliminar? Esta acciÃ³n es irreversible.",titlePrefix:"ELIMINAR",readonly:!0},info:{formAction:"info",method:"POST",buttonText:"",buttonClass:"bg-gray-500 hover:bg-gray-600 text-white",buttonIcon:o.jsx(O,{className:"w-4 h-4"}),description:"Consulta la informaciÃ³n.",titlePrefix:"INFORMACIÃ“N DE",readonly:!0}},q={create:"border-blue-300 dark:border-blue-900",update:"border-green-300 dark:border-green-900",delete:"border-red-300 dark:border-red-900",info:"border-gray-300 dark:border-gray-700"},V=(u,t,e)=>{if(u?.id)return u.id;if(u[`id_${t}`])return u[`id_${t}`]},Q=(u,t,e,c,f,x,m,i,l,s,n,d,p)=>h.useMemo(()=>{const b=u||"create",r=_[b],F=V(e,c),E=t.replace(/s$/i,""),$=`${r.titlePrefix} ${E.toUpperCase()}`,a=b==="delete",g=q[b],A=typeof s=="string"?`?tipo=${s}`:s?`?${new URLSearchParams(Object.entries(s).map(([I,N])=>[I,String(N)]))}`:"",v=I=>{I.preventDefault(),console.log("ğŸ“¤ Formulario a enviar:",n);const N=r.method==="POST"?route(`${c}.store`):route(`${c}.update`,{[c]:F}),C=Object.values(n??{}).some(j=>j instanceof File);if(console.log(`ğŸ”¹ Enviando formulario vÃ­a ${r.method} a ${N}`),C){const j=new FormData,k=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");if(!k)return console.error("âŒ No se encontrÃ³ meta CSRF token");j.append("_token",k),r.method!=="POST"&&j.append("_method",r.method),Object.entries(n).forEach(([T,y])=>{y!=null&&(y instanceof File?j.append(T,y):j.append(T,String(y)))}),w.post(N,j,{forceFormData:!0,preserveScroll:!0,preserveState:!0,onSuccess:()=>p(),onError:T=>d(y=>({...y,errors:T}))})}else r.method==="POST"&&f(N),r.method==="PATCH"&&F&&x(N),r.method==="DELETE"&&F&&m(route(`${c}.destroy`,{[c]:F}))},P=()=>r.buttonText?o.jsxs(S,{size:"sm",type:"submit",disabled:i,className:`${r.buttonClass} flex items-center gap-2`,children:[i?o.jsx(U,{className:"w-4 h-4 animate-spin"}):r.buttonIcon,r.buttonText]}):null,R=o.jsxs("div",{className:"flex items-center justify-between mt-4",children:[o.jsx(B,{href:`/${c}${A}`,children:o.jsxs(S,{size:"sm",variant:"outline",children:[o.jsx(z,{className:"w-4 h-4"})," Regresar"]})}),o.jsxs("div",{className:"flex items-center gap-x-4",children:[o.jsx(M,{show:l,enter:"transition ease-in-out",enterFrom:"opacity-0",leave:"transition ease-in-out",leaveTo:"opacity-0",children:o.jsx("p",{className:`text-sm ${a?"text-red-600":"text-neutral-600"} dark:text-neutral-400`,children:"Guardado"})}),o.jsx(P,{})]})]});return{config:r,title:$,description:r.description,readonly:r.readonly??!1,cardBorderClass:g,handleSubmit:v,FooterButtons:R}},[u,t,e,c,f,x,m,i,l,s,n]);function X({data:u,setData:t,apiConfig:e,view:c}){if(!e)return null;const f=h.useRef(null),x=async()=>{const l=u[e.inputKey]?.trim();if(!l)return alert("El campo no puede estar vacÃ­o");try{const n=await(await fetch(`undefined/${e.endpoint}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({[e.inputKey]:l})})).json();console.log(`[${c}] Respuesta API texto:`,n),Object.entries(e.fields).forEach(([d,p])=>t(d,n[p]??e.emptyValue))}catch(s){console.error(`[${c}]`,s),Object.keys(e.fields).forEach(n=>t(n,e.emptyValue))}},m=async l=>{if(!l)return;const s=new FormData;s.append("imagen",l);try{const d=await(await fetch(`undefined/${e.endpoint}`,{method:"POST",body:s})).json();console.log(`[${c}] Respuesta API imagen:`,d),Object.entries(e.fields).forEach(([p,b])=>t(p,d[b]??e.emptyValue))}catch(n){console.error(`[${c}]`,n),Object.keys(e.fields).forEach(d=>t(d,e.emptyValue))}};return({fieldKey:l})=>l!==e.inputKey?null:e.type==="file"?o.jsxs(o.Fragment,{children:[o.jsx("input",{type:"file",ref:f,className:"hidden",accept:"image/*",onChange:s=>{const n=s.target.files?.[0];n&&m(n)}}),o.jsx("button",{type:"button",className:"px-2 py-1 bg-blue-200 rounded hover:bg-blue-300 ml-1",onClick:()=>f.current?.click(),children:"ğŸ“‚ Buscar imagen"})]}):e.type==="text"?o.jsx("button",{type:"button",className:"px-2 py-1 bg-gray-200 rounded hover:bg-gray-300 ml-1",onClick:x,children:"ğŸ”"}):null}export{Q as a,Z as b,X as c,W as u};
