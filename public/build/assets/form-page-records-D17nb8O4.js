import{r as S,j as e,L as B,S as O,m as z}from"./app-tm5GzOWV.js";import{A as F}from"./app-layout-ubgrtftu.js";import{L as T}from"./form-layout-BhBfzHeQ.js";import{B as q}from"./button-DlzmkzSg.js";const P=({children:l})=>e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40"}),e.jsx("div",{className:"relative z-10 w-full flex justify-center",children:l})]}),G=({open:l,onClose:g,registro:a,parentId:x,modalFields:b,routeName:f,titulo:u,tipo:D})=>{const c=b.reduce((n,r)=>{const[i,,m]=r;return(a==null?void 0:a[i])!==void 0?n[i]=a[i]:m==="date"?n[i]=new Date().toISOString().slice(0,10):m==="time"?n[i]="08:00":n[i]="",n},{}),{data:y,setData:h,post:w,put:_,reset:j}=z({id_historia_clinica:x,...c});S.useEffect(()=>{const n=b.reduce((r,i)=>(r[i[0]]=(a==null?void 0:a[i[0]])??(i[2]==="date"?new Date().toISOString().slice(0,10):""),r),{});h({id_historia_clinica:x,...n})},[a,b]);const N=()=>{if(!a)return{};if(a.id_historia_clinica_anamnesis)return{anamnesis:a.id_historia_clinica_anamnesis};if(a.id_historia_clinica_procedimiento)return{procedimiento:a.id_historia_clinica_procedimiento};if(a.id_historia_clinica_medicamento)return{medicamento:a.id_historia_clinica_medicamento};if(a.id_historia_clinica_seguimiento)return{seguimiento:a.id_historia_clinica_seguimiento};const n=a.id??a.id_seguimiento??a.id_procedimiento??a.id_medicamento??a.id_anamnesis;return n?{id:n}:{}},v=n=>{if(n.preventDefault(),a){const r=N(),i=route(`${f}.update`,r);_(i,{data:y,onSuccess:()=>{j(),g()}})}else{const r=route(`${f}.store`);w(r,{data:y,onSuccess:()=>{j(),g()}})}};return l?e.jsx(P,{children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-lg p-6 w-full md:w-3/4 max-w-4xl",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:a?`Editar ${u}`:`Nuevo ${u}`}),e.jsxs("form",{onSubmit:v,className:"flex flex-col gap-3",children:[b.map(n=>{const[r,i,m]=n,p=y[r]??"";if(m==="textarea")return e.jsx("textarea",{value:p,onChange:o=>h(r,o.target.value),className:"w-full min-h-[80px] rounded border border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-white p-2",placeholder:i},r);if(m==="select")return e.jsxs("select",{value:p,onChange:o=>h(r,o.target.value),className:"rounded border border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-white p-2",children:[e.jsx("option",{value:"",children:"Seleccione..."}),(n[3]||[]).map(o=>e.jsx("option",{value:o.id,children:o.label},o.id))]},r);if(m==="datetime"){const o=p?p.slice(0,16):"";return e.jsx("input",{type:"datetime-local",value:o,onChange:C=>h(r,C.target.value),className:"rounded border border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-white p-2",placeholder:i},r)}return e.jsx("input",{type:m,value:p,onChange:o=>h(r,o.target.value),className:"rounded border border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-white p-2",placeholder:i},r)}),e.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[e.jsx("button",{type:"button",onClick:g,className:"px-4 py-2 rounded bg-gray-300 dark:bg-gray-700 hover:bg-gray-400 dark:hover:bg-gray-600 text-gray-900 dark:text-white",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-indigo-600 text-white hover:bg-indigo-700",children:"Guardar"})]})]})]})}):null},U=({open:l,onClose:g,onConfirm:a,itemName:x})=>l?e.jsx(P,{children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-lg p-6 w-full md:w-1/3 max-w-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:"Confirmar eliminación"}),e.jsxs("p",{className:"mb-4 text-gray-700 dark:text-gray-300",children:["¿Estás seguro de que deseas eliminar ",e.jsx("strong",{children:x}),"?"]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:g,className:"px-4 py-2 rounded bg-gray-300 dark:bg-gray-700 hover:bg-gray-400 dark:hover:bg-gray-600 text-gray-900 dark:text-white",children:"Cancelar"}),e.jsx("button",{onClick:a,className:"px-4 py-2 rounded bg-red-500 text-white hover:bg-red-600",children:"Eliminar"})]})]})}):null,V=({form_data:l,formFields:g,modalFields:a=[],procedimientoFields:x=[],medicamentoFields:b=[],anamnesisFields:f=[],action:u,custom_title:D,view:c,title:y,queryparams:h,width_form:w,toggleOptions:_,apiConfig:j,seguimientos:N=[],procedimientos:v=[],medicamentos:n=[],anamnesis:r=[]})=>{var L;const[i,m]=S.useState({open:!1,registro:null,tipo:null}),[p,o]=S.useState({open:!1,registro:null,tipo:""}),C=(l==null?void 0:l[`id_${c}`])??Number(window.location.pathname.split("/").pop()??0),A=u!=="info"&&u!=="delete",R={seguimiento:"seguimientos",procedimiento:"procedimientos",medicamento:"medicamentos",anamnesis:"anamnesis",anamnesiss:"anamnesis"},E=t=>{switch(t){case"seguimientos":return`${c}.seguimientos`;case"procedimientos":return`${c}.procedimientos`;case"medicamentos":return`${c}.medicamentos`;case"anamnesis":return`${c}.anamnesis`;default:return`${c}.anamnesis`}},M=[...r.map(t=>({...t,tipo:"Anamnesis",$displayFields:f.reduce((s,d)=>(s[d[0]]=d[1],s),{})})),...N.map(t=>({...t,tipo:"Seguimiento",$displayFields:a.reduce((s,d)=>(s[d[0]]=d[1],s),{})})),...v.map(t=>({...t,tipo:"Procedimiento",$displayFields:x.reduce((s,d)=>(s[d[0]]=d[1],s),{})})),...n.map(t=>({...t,tipo:"Medicamento",$displayFields:b.reduce((s,d)=>(s[d[0]]=d[1],s),{})}))].sort((t,s)=>new Date(t.created_at).getTime()-new Date(s.created_at).getTime());return e.jsxs(F,{breadcrumbs:[{title:y,href:c}],children:[e.jsx(B,{title:y}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 p-4",children:[e.jsx(T,{form_data:l,formFields:g,action:u,custom_title:D,view:c,width_form:w,queryparams:h,toggleOptions:_,apiConfig:j}),A&&u!=="create"&&(l==null?void 0:l[`id_${c}`])&&e.jsx("div",{className:"flex flex-wrap gap-3 mb-0",children:[{tipo:"anamnesis",label:"Anamnesis"},{tipo:"seguimientos",label:"Seguimiento"},{tipo:"procedimientos",label:"Procedimiento"},{tipo:"medicamentos",label:"Medicamento"}].map(t=>e.jsxs(q,{variant:"outline",className:"border border-gray-300 bg-gray-200 text-gray-900 hover:bg-gray-300 dark:bg-gray-800 dark:text-white dark:border-gray-700 dark:hover:bg-gray-700",onClick:()=>m({open:!0,registro:null,tipo:t.tipo}),children:["➕ Agregar ",t.label]},t.tipo))}),u!=="create"&&M.length>0&&e.jsxs("div",{className:"rounded-xl border bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 p-4 shadow",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Registro de Actividades"}),e.jsx("div",{className:"flex flex-col gap-3 overflow-y-auto max-h-[700px] pr-2",children:M.map(t=>{const s=R[t.tipo.toLowerCase()]||"anamnesis",d=t.id??t.id_anamnesis??t.id_seguimiento??t.id_procedimiento??t.id_medicamento;return e.jsxs("div",{className:"p-3 rounded-lg border bg-gray-50 dark:bg-gray-800 border-gray-200 dark:border-gray-700 shadow-sm flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-gray-800 dark:text-white",children:[t.tipo," — ",t.fecha]}),Object.entries(t.$displayFields).map(([k,I])=>{let $=t[k];return k==="id_medicamento"&&t.nombre_medicamento&&($=t.nombre_medicamento),k==="id_procedimiento"&&t.nombre_procedimiento&&($=t.nombre_procedimiento),e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:[I,": ",$??"-"]},k)})]}),A&&e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("button",{onClick:()=>m({open:!0,registro:t,tipo:s}),className:"px-2 py-1 rounded bg-yellow-500 text-white text-xs hover:bg-yellow-600",children:"Editar"}),e.jsx("button",{onClick:()=>o({open:!0,registro:t,tipo:s}),className:"px-2 py-1 rounded bg-red-500 text-white text-xs hover:bg-red-600",children:"Eliminar"})]})]},`${t.tipo}-${d}`)})})]}),e.jsx(G,{open:i.open,onClose:()=>m({open:!1,registro:null,tipo:null}),registro:i.registro,parentId:C,modalFields:i.tipo==="procedimientos"?x:i.tipo==="medicamentos"?b:i.tipo==="anamnesis"?f:a,routeName:E(i.tipo??"anamnesis"),titulo:i.tipo==="procedimientos"?"Procedimiento":i.tipo==="medicamentos"?"Medicamento":i.tipo==="anamnesis"?"Anamnesis":i.tipo==="seguimientos"?"Seguimiento":"Registro",tipo:i.tipo}),e.jsx(U,{open:p.open,itemName:((L=p.registro)==null?void 0:L.tipo)??"este registro",onClose:()=>o({open:!1,registro:null,tipo:""}),onConfirm:()=>{if(!p.registro)return;const t=E(p.tipo),s={id:p.registro.id},d=route(`${t}.destroy`,s);O.delete(d,{onSuccess:()=>o({open:!1,registro:null,tipo:""})})}})]})]})};export{V as F};
